package controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.sun.istack.internal.logging.Logger;

import model.HibernateToDoListDAO;
import model.ToDoListItem;
import model.ToDoListsPlatformException;
import model.User;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

/**
 * Servlet implementation class ToDoListController
 */
@WebServlet("/ToDoListController")
public class ToDoListController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	static Logger logger = Logger.getLogger(ToDoListController.class);
	private PrintWriter out = null;

	private static User currentUser = null;

	//creating a variable for storing the reference for the request dispatcher
	RequestDispatcher dispatcher = null;


	/**
	 * @see HttpServlet#HttpServlet()
	 */
	public ToDoListController() {
		super();

		// TODO Auto-generated constructor stub
	}



	/* (non-Javadoc)
	 * @see javax.servlet.http.HttpServlet#doGet(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)
	 */
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		// TODO Auto-generated method stub
		//checking which url address the request was equipped with
		StringBuffer sb = req.getRequestURL();
			String url = sb.toString();
		
		//comparing the uri of the request to possible texts
		logger.info("doGet");
		if (currentUser == null){
			dispatcher = getServletContext().getRequestDispatcher("/login.jsp");
			
		}else if(url.endsWith("items")) {		
			dispatcher = getServletContext().getRequestDispatcher("/items.jsp");
		}else{
			dispatcher = getServletContext().getRequestDispatcher("/error.jsp");
		}
		out.println(url);
		dispatcher.forward(req, resp);

	}


	/* (non-Javadoc)
	 * @see javax.servlet.http.HttpServlet#doPost(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)
	 */
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		out = resp.getWriter();
		logger.info("ToDoListController doPost");
		currentUser = (User)getServletContext().getAttribute("user");
		logger.info(currentUser.getUserName());

		if (currentUser != null){
			dispatcher = getServletContext().getRequestDispatcher("/usermenu.jsp");
			req.setAttribute("user", currentUser);
		}else{
			dispatcher = getServletContext().getRequestDispatcher("/login.jsp");
		}
		dispatcher.forward(req, resp);


	}

//
//	private void userDashBoard(HttpServletRequest req, HttpServletResponse resp){
//		logger.info("userDash");
//		//checking which url address the request was equipped with
//		StringBuffer sb = req.getRequestURL();
//			String url = sb.toString();
//		out.println(url);
//		//comparing the uri of the request to possible texts
//		if(url.endsWith("items")) {		
//			dispatcher = getServletContext().getRequestDispatcher("/items.jsp");
//		}else{
//			dispatcher = getServletContext().getRequestDispatcher("/error.jsp");
//
//		}
//
//		//forward the execution to the jsp document that responsible for returning
//		//the view for the very specific action the client sent a request to perform
//		try {
//			dispatcher.forward(req,resp);
//		} catch (ServletException e) {
//			// TODO Auto-generated catch block
//			e.printStackTrace();
//		} catch (IOException e) {
//			// TODO Auto-generated catch block
//			e.printStackTrace();
//		}
//	}

}
